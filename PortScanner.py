# Author: Violent Python by Justin Seitz 


import optparse
from socket import *
from threading import *



screenLock = Semaphore(value=1)

def connscan(tgthost, tgtport):
        try:
                connSkt = socket(AF_INET, SOCK_STREAM)
                connSkt.connet((tgthost, tgtport))
                connSkt.send('....\r\n')
                results = connSkt.recv(100)
                screenLock.acquire()
                print '[+]%d/tcp open' % tgtport
                print '[+] ', + str(results)
        except:
                screenLock.acquire()
                print '[-]%d/tcp closed' % tgtport
        finally:
                screenLock.release()
                connSkt.close()

def portscan(tgthost, tgtports):
        try:
                tgtIP = gethostbyname(tgthost)
        except:
                print "[-] Connot resolve '%s': Unknown host" %tgthost
                return
        try:
                tgtname = gethostbyaddr(tgtIP)
                print '\n[+] Scan Results for: ' + tgtname[0]
        except:
                print '\n[+] Scan Results for: ' + tgtIP
        setdefaulttimeout(1)
        for tgtport in tgtports:
                t = Thread(target = connscan, args = (tgthost, int(tgtport)))
                t.start()
def main ():
        parser = optparse.OptionParser('usage %prog -H <target host> -p <target port>')
        parser.add_option('-H', dest='tgthost', type='string', help='specify target host')
        parser.add_option('-p', dest='tgtport', type='string', help='specify target port[s] seperated by comma')
        (options, args) = parser.parse_args()
        tgthost = options.tgthost
        tgtports = str(options.tgtport).split(',')
        if (tgthost == None) | (tgtports == None):
                print parser.usage
                exit(0)
        portscan(tgthost, tgtports)

if __name__ == '__main__':
    main()
